<!DOCTYPE html>
<html>
  <head>
    <title>Profile | OptimaBankWeb</title>
    <link rel="stylesheet" href="../css/profile.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <script src="../user_points.js"></script>

    <script>
      function logout() {
        firebase
          .auth()
          .signOut()
          .then(() => {
            window.location.href = "../auth/login.html";
          });
      }
    </script>
    <style>
      .profile-image {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        /* space between img and input */
      }

      .profile-image img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ccc;
      }

      .profile-image input {
        margin-top: 5px;
      }

      .upload-btn {
        margin-top: 8px;
        padding: 6px 14px;
        background-color: #ff9800;
        color: white;
        font-size: 0.9em;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .upload-btn:hover {
        background-color: #e68900;
      }
    </style>
  </head>

  <body>
    <div class="loader-overlay" id="loader">
      <div class="spinner"></div>
    </div>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="navbar-left">
        <span class="logo">OptimaBank</span>
      </div>
      <div class="navbar-center">
        <a href="../dashboard.html">Home</a>
        <div class="dropdown" id="voucherDropdown">
          <a href="#" class="dropdown-toggle" id="dropdownBtn"
            >Voucher <span class="dropdown-arrow">&#9662;</span></a
          >
          <div class="dropdown-menu" id="dropdownMenu">
            <div class="dropdown-item">
              <div class="dropdown-title">Appliances</div>
              <div class="dropdown-desc">
                Discounts or credits for home and kitchen gadgets.
              </div>
              <span class="dropdown-chevron">&#8250;</span>
            </div>
            <div class="dropdown-item">
              <div class="dropdown-title">Decoration</div>
              <div class="dropdown-desc">
                Savings on home décor, furnishings, or festive ornaments.
              </div>
              <span class="dropdown-chevron">&#8250;</span>
            </div>
            <div class="dropdown-item">
              <div class="dropdown-title">Cosmetic</div>
              <div class="dropdown-desc">
                Deals on skincare, makeup, or beauty products.
              </div>
              <span class="dropdown-chevron">&#8250;</span>
            </div>
            <div class="dropdown-item">
              <div class="dropdown-title">Apparel</div>
              <div class="dropdown-desc">
                Vouchers for clothing, shoes, or fashion accessories.
              </div>
              <span class="dropdown-chevron">&#8250;</span>
            </div>
            <div class="dropdown-item">
              <div class="dropdown-title">Travel</div>
              <div class="dropdown-desc">
                Discounts on flights, hotels, or vacation packages.
              </div>
              <span class="dropdown-chevron">&#8250;</span>
            </div>
          </div>
        </div>
      </div>
      <div class="navbar-right">
        <span class="cart-icon">&#128722;</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </nav>

    <div class="profile-container">
      <form id="profileForm">
        <div class="profile-row">
          <div class="profile-card personal-details">
            <h2>Personal Details</h2>
            <div class="personal-content">
              <div class="profile-image">
                <img
                  id="profile-image-preview"
                  src="../assets/default-profile.png"
                  alt="Profile"
                />
                <label for="profile-image-upload" class="upload-btn"
                  >Upload Photo</label
                >
                <input
                  type="file"
                  id="profile-image-upload"
                  accept="image/*"
                  hidden
                />
              </div>
              <div class="profile-fields">
                <label for="profile-name">Full Name:</label>
                <input type="text" id="profile-name" required />

                <label for="profile-email">Email (read-only):</label>
                <input type="email" id="profile-email" readonly />

                <label for="profile-phone">Phone Number:</label>
                <input type="tel" id="profile-phone" required />

                <label for="profile-username">Username:</label>
                <input type="text" id="profile-username" />
              </div>
            </div>
          </div>

          <div class="profile-card contact-details">
            <h2>Details</h2>
            <div class="contact-fields">
              <!-- About field -->
              <label for="profile-about">About Me:</label>
              <textarea
                id="profile-about"
                rows="3"
                placeholder="Tell us about yourself..."
              ></textarea>

              <!-- Single Address (combine Address 1–3, postcode, state) -->
              <label for="profile-address">Address:</label>
              <input
                type="text"
                id="profile-address"
                value="Lot 1920,Taman Intan Baiduri, Jalan Baiduri, 78300, Perak"
                readonly
              />
            </div>
          </div>
        </div>

        <div class="profile-row">
          <!-- Total Points Card -->
          <div
            class="profile-card total-points-card"
            style="
              flex: 0.5;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
            "
          >
            <h2 style="margin-bottom: 20px">Total Points</h2>
            <div
              id="points-balance"
              style="font-size: 2.5em; font-weight: bold; color: #ff9800"
            >
              counting..
            </div>
            <!-- Hidden inputs required for JS -->
            <input type="hidden" id="profile-points" />
            <input type="hidden" id="profile-active" />
            <input type="hidden" id="profile-image" />
            <input type="hidden" id="profile-updated" />
          </div>
        </div>

        <!-- Centered Save Button -->
        <div style="padding: 20px; text-align: center">
          <button class="orange-btn" type="submit">Save Changes</button>
          <div id="profile-success" class="success-message"></div>
          <div id="profile-error" class="error-message"></div>
        </div>
      </form>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-col">
          <h4>Loyalty Rewards</h4>
          <p>
            Earn points on every purchase and redeem for exclusive rewards and
            experiences.
          </p>
        </div>
        <div class="footer-col">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="#">Rewards Catalog</a></li>
            <li><a href="#">Terms & Conditions</a></li>
            <li><a href="#">FAQ</a></li>
            <li><a href="#">Contact Support</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Connect With Us</h4>
          <div class="footer-socials">
            <span class="footer-social"></span
            ><span class="footer-social"></span
            ><span class="footer-social"></span>
          </div>
          <div class="footer-newsletter">
            <span>Subscribe to our newsletter</span>
            <div class="newsletter-input">
              <input type="email" placeholder="Your email" /><button
                type="button"
              ></button>
            </div>
          </div>
        </div>
        <div class="footer-col">
          <h4>Download App</h4>
          <a href="#" class="footer-app-btn appstore"
            >Download on the<br /><strong>App Store</strong></a
          ><a href="#" class="footer-app-btn googleplay"
            >Get it on<br /><strong>Google Play</strong></a
          >
        </div>
      </div>
      <div class="footer-bottom">
        © 2023 Loyalty Rewards. All rights reserved.
      </div>
    </footer>

    <!-- Dropdown script -->
    <script>
      const dropdown = document.getElementById("voucherDropdown");
      const btn = document.getElementById("dropdownBtn");
      document.addEventListener("click", function (e) {
        if (btn.contains(e.target)) {
          e.preventDefault();
          dropdown.classList.toggle("open");
        } else if (!dropdown.contains(e.target)) {
          dropdown.classList.remove("open");
        }
      });
    </script>
    <script src="profile.js"></script>
  </body>
</html>
